name: "Cloudflare Deploy"
description: "Deploy to Cloudflare Pages"

inputs:
  cloudflare_api_token:
    description: "Cloudflare API Token"
    required: true
  repository:
    description: 'The GitHub repository to deploy, in the format "organization/repository"'
    required: true
  production_branch:
    description: "Production Branch"
    required: true
  output_directory:
    description: "Output Directory"
    required: true

runs:
  using: "composite"
  steps:
    - name: Checkout work.ubq.fi
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.repository }}
        path: ${{ inputs.repository.split('/')[1] }}
    - name: Checkout cloudflare-deploy-action
      uses: actions/checkout@v4
      with:
        repository: "ubiquity/cloudflare-deploy-action"
        path: "cloudflare-deploy-action"
    - name: Display file tree
      run: |
        sudo apt-get install -y tree
        tree
      shell: bash
    - run: ./cloudflare-deploy-action/cloudflare-deploy.sh ${{ inputs.repository }} ${{ inputs.production_branch }} ${{ inputs.output_directory }}
      shell: bash
      env:
        CLOUDFLARE_API_TOKEN: ${{ inputs.cloudflare_api_token }}
